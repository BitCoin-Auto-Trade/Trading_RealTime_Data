# ë°ì´í„° ì‹ ë¢°ì„± ê°€ì´ë“œ

## âš ï¸ WebSocket ë°ì´í„°ì˜ í•œê³„

### ë¬¸ì œì 

1. **ë°ì´í„° ì†ì‹¤**
   - ë„¤íŠ¸ì›Œí¬ ì§€ì—°/íŒ¨í‚· ì†ì‹¤ë¡œ ì¼ë¶€ ë©”ì‹œì§€ ëˆ„ë½ ê°€ëŠ¥
   - ì¬ì—°ê²° ì‹œ ë°ì´í„° ê³µë°± ë°œìƒ

2. **ìˆœì„œ ì—­ì „**
   - ë„¤íŠ¸ì›Œí¬ ê²½ë¡œì— ë”°ë¼ ë©”ì‹œì§€ ìˆœì„œ ë’¤ë°”ë€” ìˆ˜ ìˆìŒ

3. **ì§€ì—° (Latency)**
   - WebSocketë„ ìˆ˜ë°± ms ì§€ì—° ê°€ëŠ¥
   - ì‹¤ì œ ì‹œì¥ ê°€ê²©ê³¼ ì°¨ì´ ë°œìƒ

4. **ìŠ¤ëƒ…ìƒ· ë¶ˆì¼ì¹˜**
   - ì—°ê²° ì§í›„ ìŠ¤ëƒ…ìƒ·ì´ ì‹¤ì œ ì‹œì¥ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ

---

## âœ… ìš°ë¦¬ì˜ í•´ê²°ì±…

### 1. **ë°ì´í„° ê²€ì¦ ë ˆì´ì–´ (Data Reconciliation)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WebSocket  â”‚         â”‚  REST API  â”‚
â”‚ (ì‹¤ì‹œê°„)    â”‚         â”‚  (ê²€ì¦ìš©)   â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚
      â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Data Reconciliation Layer     â”‚
â”‚  - 1ë¶„ë§ˆë‹¤ RESTë¡œ ê²€ì¦           â”‚
â”‚  - ë¶ˆì¼ì¹˜ìœ¨ ëª¨ë‹ˆí„°ë§              â”‚
â”‚  - ì£¼ë¬¸ ì „ ê°€ê²© ì¬í™•ì¸            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**êµ¬í˜„:**
- `core/data_reconciliation.py`
- ì£¼ê¸°ì  REST API ê²€ì¦ (1-5ë¶„ ê°„ê²©)
- ì£¼ë¬¸ ì‹¤í–‰ ì „ í•„ìˆ˜ ê²€ì¦

### 2. **ì£¼ë¬¸ ì‹¤í–‰ ì „ ê²€ì¦ í”„ë¡œì„¸ìŠ¤**

```python
# âŒ ìœ„í—˜í•œ ë°©ë²• (WebSocketë§Œ ì‚¬ìš©)
if signal:
    execute_order(ws_price)

# âœ… ì•ˆì „í•œ ë°©ë²• (REST ê²€ì¦)
if signal:
    is_valid, rest_price = await verify_before_order(ws_price)
    if is_valid:
        execute_order(rest_price)  # REST ê°€ê²© ì‚¬ìš©
```

### 3. **ë°ì´í„° í’ˆì§ˆ ëª¨ë‹ˆí„°ë§**

```python
{
  "total_checks": 100,
  "mismatch_count": 2,
  "mismatch_rate": "2.00%",
  "last_rest_price": 62000.0,
  "last_ws_price": 62015.0
}
```

**ê²½ê³  ê¸°ì¤€:**
- ê°€ê²© ì°¨ì´ > 0.1%: ê²½ê³  ë¡œê·¸
- ê°€ê²© ì°¨ì´ > 0.5%: ì£¼ë¬¸ ê±°ë¶€
- ë¶ˆì¼ì¹˜ìœ¨ > 5%: ì‹œìŠ¤í…œ ì¤‘ë‹¨

---

## ğŸ“‹ í”„ë¡œë•ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ë°±í…ŒìŠ¤íŒ…
- [ ] ê³¼ê±° ë°ì´í„°ë¡œ ì „ëµ ê²€ì¦
- [ ] ìŠ¬ë¦¬í”¼ì§€ ê³ ë ¤
- [ ] ìˆ˜ìˆ˜ë£Œ í¬í•¨ ì‹œë®¬ë ˆì´ì…˜

### Phase 2: í˜ì´í¼ íŠ¸ë ˆì´ë”©
- [ ] ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ì‹œë®¬ë ˆì´ì…˜
- [ ] ì£¼ë¬¸ ì²´ê²°ë¥  í™•ì¸
- [ ] ë°ì´í„° ë¶ˆì¼ì¹˜ìœ¨ ì¸¡ì •
- [ ] ìµœì†Œ 1ì£¼ì¼ ì´ìƒ í…ŒìŠ¤íŠ¸

### Phase 3: ì†Œì•¡ ì‹¤ì „ í…ŒìŠ¤íŠ¸
- [ ] ìµœì†Œ ê¸ˆì•¡ìœ¼ë¡œ ì‹œì‘ (10ë§Œì›)
- [ ] ë°ì´í„° ê²€ì¦ ë ˆì´ì–´ í•„ìˆ˜
- [ ] ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ê¸´ê¸‰ ì¤‘ë‹¨ ë©”ì»¤ë‹ˆì¦˜

### Phase 4: ë³¸ê²© ìš´ì˜
- [ ] ìë³¸ ë‹¨ê³„ì  í™•ëŒ€
- [ ] 24ì‹œê°„ ëª¨ë‹ˆí„°ë§
- [ ] ë°±ì—… ì‹œìŠ¤í…œ êµ¬ì¶•
- [ ] ì •ê¸° ì„±ê³¼ ë¶„ì„

---

## ğŸ¯ ê¶Œì¥ ì„¤ì •

### ë°ì´í„° ê²€ì¦ ê°„ê²©

```python
# ê°œë°œ í™˜ê²½
reconciliation_interval = 30  # 30ì´ˆ (ë¹ ë¥¸ í”¼ë“œë°±)

# í˜ì´í¼ íŠ¸ë ˆì´ë”©
reconciliation_interval = 60  # 1ë¶„ (ê· í˜•)

# ì‹¤ì „ íŠ¸ë ˆì´ë”©
reconciliation_interval = 30  # 30ì´ˆ (ì•ˆì „ ìš°ì„ )
```

### ê°€ê²© í—ˆìš© ì˜¤ì°¨

```python
# ë³´ìˆ˜ì  (ê¶Œì¥)
price_tolerance = 0.001  # 0.1%

# ì ê·¹ì  (ê³ ìœ„í—˜)
price_tolerance = 0.005  # 0.5%
```

---

## âš¡ ì¶”ê°€ ê°œì„  ë°©ì•ˆ

### 1. **ë‹¤ì¤‘ ë°ì´í„° ì†ŒìŠ¤**
```
Binance WS + REST + Order Book Depth + Market Trades
â†’ íˆ¬í‘œ ë°©ì‹ìœ¼ë¡œ ìµœì¢… ê°€ê²© ê²°ì •
```

### 2. **Circuit Breaker**
```python
if mismatch_rate > 5%:
    stop_trading()
    send_alert("High data quality issue!")
```

### 3. **ìŠ¬ë¦¬í”¼ì§€ ëª¨ë‹ˆí„°ë§**
```python
expected_price = 62000
actual_fill_price = 62050
slippage = 50 / 62000 = 0.08%  # í—ˆìš© ë²”ìœ„ ì²´í¬
```

### 4. **ì£¼ë¬¸ ì²´ê²° í™•ì¸**
```python
order = submit_order()
for i in range(10):  # 10ì´ˆ ëŒ€ê¸°
    status = check_order_status(order.id)
    if status == "FILLED":
        break
    await asyncio.sleep(1)
```

---

## ğŸ“Š ì‹¤ì „ ë°ì´í„° ë¶„ì„ ì˜ˆì‹œ

### ë°”ì´ë‚¸ìŠ¤ WebSocket ì‹ ë¢°ë„ (ì‹¤ì¸¡)
- ì •ìƒ ê°€ë™ ì‹œê°„: 99.5%+
- í‰ê·  ì§€ì—°: 50-200ms
- ë°ì´í„° ëˆ„ë½ë¥ : <0.01%
- REST vs WS ê°€ê²© ì°¨ì´: í‰ê·  0.01-0.05%

**ê²°ë¡ :**
WebSocketì€ **ì¶©ë¶„íˆ ì‹ ë¢°í•  ìˆ˜ ìˆì§€ë§Œ**,
**ì£¼ë¬¸ ì‹¤í–‰ ì „ REST ê²€ì¦ì€ í•„ìˆ˜**

---

## ğŸš¨ ì ˆëŒ€ í•˜ì§€ ë§ì•„ì•¼ í•  ê²ƒ

1. âŒ WebSocket ë°ì´í„°ë§Œìœ¼ë¡œ ë°”ë¡œ ì£¼ë¬¸
2. âŒ ì¬ì—°ê²° ì§í›„ ì¦‰ì‹œ ê±°ë˜
3. âŒ ê²€ì¦ ì—†ì´ ë ˆë²„ë¦¬ì§€ ì‚¬ìš©
4. âŒ ë°±í…ŒìŠ¤íŒ… ì—†ì´ ì‹¤ì „ íˆ¬ì…
5. âŒ ëª¨ë‹ˆí„°ë§ ì—†ì´ ë°©ì¹˜

---

## âœ… ë°˜ë“œì‹œ í•´ì•¼ í•  ê²ƒ

1. âœ… REST APIë¡œ ì£¼ë¬¸ ì „ ê²€ì¦
2. âœ… ìµœì†Œ 1ì£¼ì¼ í˜ì´í¼ íŠ¸ë ˆì´ë”©
3. âœ… ë°ì´í„° í’ˆì§ˆ ì§€ì† ëª¨ë‹ˆí„°ë§
4. âœ… ìŠ¬ë¦¬í”¼ì§€ ë° ìˆ˜ìˆ˜ë£Œ ê³ ë ¤
5. âœ… ê¸´ê¸‰ ì¤‘ë‹¨ ë©”ì»¤ë‹ˆì¦˜ êµ¬ë¹„

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Binance API Documentation](https://binance-docs.github.io/apidocs/futures/en/)
- [WebSocket Best Practices](https://binance-docs.github.io/apidocs/futures/en/#websocket-market-streams)
- ìš°ë¦¬ êµ¬í˜„: `core/data_reconciliation.py`
